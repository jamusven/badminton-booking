<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>{{ .Title }} - {{ $.Me.Name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        .inline, .inline * {
            display: inline;
        }

        fieldset {
            border-radius: 10px;
            margin-top: 10px;
        }

    </style>

    <script>
    window.onload = function () {
        let labels = document.querySelectorAll("fieldset div label");

        for (var i = 0; i < labels.length; i++) {
            let text = labels[i].querySelector("span").textContent

            if (text == "ç¡®è®¤") {
                labels[i].parentNode.parentNode.style.backgroundColor = "lightGreen";
            } else {
                labels[i].parentNode.parentNode.style.backgroundColor = "orange";
            }
        }

        let drivers = {{ .Drivers  }};
        let bodyHtml = document.body.innerHTML;

        for (let i = 0, max = drivers.length; i < max ; i++) {
            let regex = new RegExp(drivers[i], 'g');
            bodyHtml = bodyHtml.replace(regex, drivers[i] + 'ğŸš˜');
        }

        document.body.innerHTML = bodyHtml;
    }

    function checkVenueFee(form) {
        let venueFee = form['venueFee'].value;
        let ballFee = form['ballFee'].value;
        let trainingFee = form['trainingFee'].value;

        if (!venueFee && !ballFee && !trainingFee) {
            if (!confirm('ç¡®å®šè¦å–æ¶ˆåœºåœ°å—ï¼Ÿ')) {
                return false;
            }
        }

        return true;
    }

    </script>
</head>
<body style="background-color: white">
<div>
    <p>
        <div>
            <label>ä½™é¢</label> <span>{{ printf "%.2f" $.Me.Balance }}</span>
            <label>è½¦è´¹ä½™é¢</label> <span>{{ printf "%.2f" $.Me.FareBalance }}</span>
            <a target="_blank" href="/user/transaction?ticket={{ $.Ticket }}">äº¤æ˜“è®°å½•</a>
        </div>

        <div>
            <label>è½¦è´¹</label> <span>{{ printf "%.2f" $.Me.FareFee }}</span>
            <label>åœºåœ°</label> <span>{{ printf "%.2f" $.Me.VenueFee }}</span>
            <label>çƒè´¹</label> <span>{{ printf "%.2f" $.Me.BallFee }}</span>
            <label>è®­ç»ƒ</label> <span>{{ printf "%.2f" $.Me.TrainingFee }}</span>
        </div>
    </p>

    <p>
        <form action="/user/transfer" method="post">
            <label>å‘</label>
            <label>
                <select name="targetUID">
                    {{ range .Users }}
                    {{ if ne .State $.UserStateZombie }}
                    <option value="{{ .ID }}">{{ .Name }}</option>
                    {{ end }}}
                    {{ end }}
                </select>
            </label>

            <label>è½¬è´¦</label>

            <label>
                <select name="transactionType">
                    <option value="{{ $.TransactionTypeFare }}">{{ index $.TransactionTypeMap $.TransactionTypeFare }}</option>
                    <option value="{{ $.TransactionTypeBalance }}">{{ index $.TransactionTypeMap $.TransactionTypeBalance }}</option>
                </select>
            </label>

            <label>
                <input name="amount" placeholder="é‡‘é¢" size="6" />
            </label>

            <input type="hidden" name="ticket" value="{{ $.Ticket }}" />
            <input type="submit" value="ç¡®è®¤" />
        </form>
    </p>
</div>

{{ range .Venues }}
<fieldset>
    <legend>{{ .Name }} {{ .Day }} {{ getWeekDay .Day }} {{ .Desc }}</legend>
    <div>
        <form method="post" action="/venue/booking">
            <label>
                æŠ¥åï¼š
                <span style="color: red; font-weight: bold;">
                {{- with index (index $.BookingSummaries .ID).AnswerValues $.Me.Name -}}
                {{- index $.BookingStateMap . -}}
                {{- else -}}
                æœªé€‰æ‹©
                {{- end -}}
                </span>

                <select name="state">
                    <option value="{{ $.BookingStateOK }}">{{ index $.BookingStateMap $.BookingStateOK }}</option>
                    <option value="{{ $.BookingStateNO }}">{{ index $.BookingStateMap $.BookingStateNO }}</option>
                    <option value="{{ $.BookingStateManual }}">{{ index $.BookingStateMap $.BookingStateManual }}</option>
                </select>

                <input type="hidden" name="venueId" value="{{ .ID }}">
                <input type="hidden" name="ticket" value="{{ $.Ticket }}">

                <input type="text" placeholder="å¤–æŒ‚å§“å" size="8" name="worker">
                <input type="submit" value="ç¡®è®¤">
            </label>
        </form>
    </div>

    <p>
        <div class="inline">é™åˆ¶ : Min.{{ .Amount }} / Max.{{ .Limit }}</div>

        <form class="inline" method="post" action="/venue/stat">
            <input type="hidden" name="venueId" value="{{ .ID }}">
            <input type="hidden" name="ticket" value="{{ $.Ticket }}">
            <input type="submit" value="ç»Ÿè®¡é€šçŸ¥">
        </form>

        <form class="inline" method="post" action="/venue/depart">
            <input type="hidden" name="venueId" value="{{ .ID }}">
            <input type="hidden" name="ticket" value="{{ $.Ticket }}">
            <input type="submit" value="å‡ºå‘é€šçŸ¥">
        </form>
    </p>

    <p>
        ç»Ÿè®¡ï¼š{{ (index $.BookingSummaries .ID).AnswerCounter }}
    </p>

    <p>
        <a href="/logs/{{ sha1 (toString (toIntFromUint .ID)) }}.log?_time={{ now }}">è¯¦æƒ…</a>ï¼š{{ (index $.BookingSummaries .ID).AnswerResponses }}
    </p>

    <p>
    {{ if or (eq $.UserStateAdmin ($.Me.State)) (eq .Owner ($.Me.ID))  }}
    <form method="post" action="/venue/limit">
        <p>
            é™åˆ¶ï¼š
            <input type="hidden" name="venueId" value="{{ .ID }}">
            <input type="hidden" name="ticket" value="{{ $.Ticket }}">
            <input type="text" size="4" name="amount" placeholder="Min" {{ if eq .Amount 0 }}value="" {{ else }}value="{{ .Amount }}"{{end}}>
            <input type="text" size="4" name="limit" placeholder="Max" {{ if eq .Limit 0 }}value="" {{ else }}value="{{ .Limit }}"{{end}}>
            çƒé¦†ï¼š
            <input type="text" size="5" name="name" placeholder="åœºåœ°å" value="{{ .Name }}">
        </p>
        <p>
            ä¿¡æ¯ï¼š
            <input type="text" name="desc" placeholder="åœºåœ°ä¿¡æ¯" value="{{ .Desc }}">
        </p>
        <p>
            æ—¥æœŸï¼š
            <input type="text" size="10" name="day" placeholder="æ—¥æœŸ" value="{{ .Day }}">
            <input type="submit" value="è®¾ç½®">
        </p>
    </form>

    <form method="post" action="/venue/done1" onsubmit="return checkVenueFee(this)">
        ç»“æŸï¼š
        <input type="hidden" name="venueId" value="{{ .ID }}">
        <input type="hidden" name="ticket" value="{{ $.Ticket }}">
        <input type="text" size="6" name="venueFee" placeholder="åœºåœ°è´¹">
        <input type="text" size="6" name="ballFee" placeholder="çƒè´¹">
        <input type="text" size="6" name="trainingFee" placeholder="è®­ç»ƒè´¹">
        <input type="submit" value="ç»“æŸ">
    </form>
    {{ end }}

</fieldset>
{{ end }}

<div>
    <form method="post" action="/venue/create">
        <fieldset>
            <legend> åˆ›å»ºåœºåœ° </legend>
            <label>
                <input type="text" placeholder="åœºåœ°åç§°" name="name">
                <input type="text" placeholder="åœºåœ°æ—¥æœŸ {{ .NowYMD }}" name="day">
                <input type="text" placeholder="åœºåœ°ä¿¡æ¯ å¦‚: 12x2(3 4)" name="desc" value="">
                <select name="notification">
                    <option value="1">å…è®¸é€šçŸ¥</option>
                    <option value="0">å¿½ç•¥é€šçŸ¥</option>
                </select>
                <input type="hidden" name="ticket" value="{{ .Ticket }}">
                <input type="submit" value="ç¡®è®¤">
            </label>
        </fieldset>
    </form>
</div>
</body>
</html>